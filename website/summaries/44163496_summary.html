<article>
    <h2>Conformance checking at MongoDB: Testing that our code matches our TLA&#43; specs</h2>
    <div>
<div>
<h3>Summary</h3>
The article discusses how MongoDB uses Conformance Checking to ensure that their code accurately implements the specifications defined in their TLA+ specifications. It highlights the challenges in verifying complex distributed systems and explains how they leverage formal specifications using TLA+ to model the intended behavior of their systems. The core idea is to automatically verify whether the actual execution traces generated by running tests on the MongoDB code match the expected behaviors described in the TLA+ specifications. This is achieved through a system that observes the execution of the code under test, extracts relevant events, and then checks if the sequence of these events conforms to the rules defined in the TLA+ specification.

The article details the architecture of their conformance checking system, which involves instrumenting the code to emit events, collecting these events during test execution, translating these events into a format understandable by the TLA+ model checker (TLC), and then using TLC to verify conformance. They describe the custom tools and infrastructure they've built to streamline this process, including a system for annotating the code with specifications, a mechanism for extracting execution traces, and a translator to convert these traces into TLA+ compatible inputs.

A key aspect of their approach is the use of temporal logic to express properties of the system's behavior over time. The TLA+ specifications define invariants and temporal properties that the system must satisfy. The conformance checking system then checks if the observed execution traces violate any of these properties. They provide examples of how they've used this system to detect subtle bugs and inconsistencies in their code that would have been difficult to find through traditional testing methods.

The benefits of using conformance checking include increased confidence in the correctness of the implementation, early detection of bugs, and improved understanding of the system's behavior. The article emphasizes that conformance checking complements traditional testing methods by providing a more rigorous and formal approach to verification. It also highlights the importance of having well-defined TLA+ specifications, as the effectiveness of the conformance checking system depends on the quality and completeness of these specifications. They note that this approach is particularly useful for verifying the correctness of complex distributed systems where emergent behavior is difficult to reason about.

Finally, the article outlines some of the challenges they faced in implementing conformance checking, such as the complexity of translating execution traces into TLA+ input and the performance overhead of instrumenting the code. They also discuss future directions for their work, including improving the automation of the conformance checking process and extending its applicability to other parts of the MongoDB codebase.

<h3>Key Points</h3>
<ul>
<li>MongoDB uses Conformance Checking to verify if their code matches TLA+ specifications.</li>
<li>TLA+ specifications formally model the intended behavior of distributed systems.</li>
<li>The system instruments code to emit events during test execution.</li>
<li>Execution traces are collected and translated into a format suitable for the TLA+ model checker (TLC).</li>
<li>TLC verifies whether the execution traces conform to the TLA+ specifications.</li>
<li>Temporal logic is used to express properties of the system's behavior over time.</li>
<li>Conformance checking helps detect subtle bugs and inconsistencies.</li>
<li>The approach complements traditional testing methods with a more rigorous verification.</li>
<li>The effectiveness of the system relies on well-defined TLA+ specifications.</li>
<li>Challenges include translating execution traces and performance overhead.</li>
</ul>
</div>
</div>
</article>
